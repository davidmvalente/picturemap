#!/usr/bin/env python

import sys, os, glob
from picturemap import *

def main():
    #Read arguments
    script = sys.argv[0]
    arguments = sys.argv[1:]

    if len(sys.argv) < 2:
      print("""Please specify at least one image file or a folder
                \n Example: picturemap Pictures/*.jpg
                \n Example: picturemap Pictures """)
      sys.exit(1)  # abort because of error

    elif os.path.isdir(arguments[0]):
        print(arguments[0]+' is a directory')
        print('Looking for all JPG files: '+arguments[0]+'/**/*.JPG')
        filenames = []
        for filename in glob.iglob(arguments[0]+'/**/*.JPG', recursive=True):
            filenames.append(filename)

    else:
        filenames = arguments

    print(str(len(filenames))+ ' image files were found.')

    #Pick destination path for visualization filenames
    target_directory = set_target(filenames)
    #Process files
    pictures_data = get_metadata(filenames, target_directory) #Get name, date, coordinates
    pictures_data['centre'] = set_centre(pictures_data['coordinates']) #Find centre coordinates
    #Build the map
    build(pictures_data, target_directory)
    launch(target_directory+'picturemap.html')

main()
